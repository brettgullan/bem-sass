// ==============================
// 
//         Mixins - BEM
//
// ============================== 

@mixin init-BEM() {
  $__BEM-entities__: () !global;
}

// Set BEM configurations 
//
// @param { map } a BEM separator map (e.g (element: "__", modifier: "_"))
@mixin configure-BEM($map:null) { 
  $defaults: (
    default-prefix: "",
    block-types: (),
    element-sep: "__",
    modifier-sep: "_"
  );

  @if ($map) {
    $defaults: map-merge($defaults, $map);
  } 

  $__BEM-default-prefix__: map-get($defaults, "default-prefix") !global;
  $__BEM-block-types__: map-get($defaults, "block-types") !global;
  $__BEM-element-sep__: map-get($defaults, "element-sep") !global;
  $__BEM-modifier-sep__: map-get($defaults, "modifier-sep") !global;
}


// Generate BEM block selector 
//
// @param { String } name of the block
// @param { String } type of the block
// @author Yum<ym.jsng@gmail.com>
// @example
//  @include block(promo) {
//    ...styles here...
//  }
//  @include block(media, "object") {
//    ...styles here...
//  }
@mixin block($name, $type:null) {

  $BEM-block-entity: make-BEM-block-selector($name, $type);

  @if BEM-entity-exists($BEM-block-entity) {
    @error "Attempt to reassign `#{$BEM-block-entity}`"
  } 

  @if (register-BEM-entity($BEM-block-entity)) {
    #{$BEM-block-entity} {
      @content;
    }
  };

}


// Generate BEM element selector 
//
// @param { String } name of the element
// @author Yum<ym.jsng@gmail.com>
@mixin element($name) { 

  @if (& == null) {
    @error "element cannot be declared outside of a block"
  }

  @if (is-BEM-element(&)) {
    @error "element cannot be declared in another element"
  }

  @at-root {
    $BEM-element-entity: make-BEM-element-selector($name, is-BEM-modifier(&));

    @if BEM-entity-exists($BEM-element-entity) {
      @error "Attempt to reassign `#{$BEM-element-entity}`"
    }

    @if (register-BEM-entity($BEM-element-entity)) {
      #{$BEM-element-entity} {
        @content;
      }
    }
  }
}


// Generate BEM modifier selector 
//
// @param { String } name of the modifier 
// @author Yum<ym.jsng@gmail.com>
@mixin modifier($name, $value: null) { 
  @if (& == null) {
    @error "modifier cannot be declared ouside of a block"
  }

  @at-root {
    $BEM-modifier-entity: make-BEM-modifier-selector($name, $value, is-BEM-element(&));
    
    @if BEM-entity-exists($BEM-modifier-entity) {
      @error "Attempt to reassign `#{$BEM-modifier-entity}`"
    }

    @if register-BEM-entity($BEM-modifier-entity) {
      #{$BEM-modifier-entity} {
        @content;
      }
    }
  }
}
